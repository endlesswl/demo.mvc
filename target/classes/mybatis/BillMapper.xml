<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.palm.lingcai.repository.BillDao">

	<resultMap id="resultMap" type="com.palm.lingcai.entity.Bill">
        <result property="id" column="id"/>
        <result property="orderid" column="orderid"/>
        <result property="serialno" column="serialno"/>
        <result property="tradeno" column="tradeno"/>
        <result property="amount" column="amount"/>
        <result property="userid" column="userid"/>
        <result property="billtime" column="billtime"/>
        <result property="indecr" column="indecr"/>
        <result property="billchannel" column="billchannel"/>
        <result property="billret" column="billret"/>
        <result property="prebalance" column="prebalance"/>
        <result property="ipaddr" column="ipaddr"/>
        <result property="salt" column="salt"/>
        <result property="packets" column="packets"/>
        <result property="createtime" column="createtime"/>
        <result property="modifytime" column="modifytime"/>
        <result property="expiretime" column="expiretime"/>
        <result property="information" column="information"/>
        <result property="locked" column="locked"/>
        <result property="confirmed" column="confirmed"/>
        <result property="afterbalance" column="afterbalance"/>
        <result property="subject" column="subject"/>
        <result property="method" column="method"/>
         <result property="balanceid" column="balanceid"/>
        
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
		id,orderid,serialno,tradeno,amount,userid,billtime,indecr,billchannel,billret,prebalance,ipaddr,salt,packets,createtime,modifytime,expiretime,information,locked,confirmed,afterbalance,subject,method,balanceid
	</sql>
	
	<!-- 获取对象: 输出直接映射到对象 -->
	<select id="get" parameterType="Long" resultType="Bill">
		SELECT <include refid="columns" />
		FROM tab_bill
		WHERE id=#{id}
	</select>

    <!-- 获取对象: 输出直接映射到对象 -->
	<select id="getByOrderid" parameterType="Long" resultType="Bill">
		SELECT <include refid="columns" />
		FROM tab_bill
		WHERE orderid=#{orderid} limit 1
	</select>

    <!-- 获取对象: 输出直接映射到对象 -->
    <select id="getOneByOrderidAndIndecr" resultType="Bill">
        SELECT <include refid="columns" />
        FROM tab_bill
        <where>
        <if test="orderid != null">
            AND orderid = #{orderid}
        </if>
        <if test="indecr != null">
            AND indecr = #{indecr}
        </if>
        </where>
    </select>

	<!-- 查询列表, 不分页 -->
	<select id="search" parameterType="map" resultMap="resultMap">
		SELECT <include refid="columns" />
		FROM tab_bill
		<where>
	       <if test="orderid != null and orderid != ''">
				AND orderid = #{orderid}
		   </if>
	       <if test="serialno != null and serialno != ''">
				AND serialno = #{serialno}
		   </if>
	       <if test="tradeno != null and tradeno != ''">
				AND tradeno = #{tradeno}
		   </if>
	       <if test="amount != null and amount != ''">
				AND amount = #{amount}
		   </if>
	       <if test="userid != null and userid != ''">
				AND userid = #{userid}
		   </if>
	       <if test="billtime != null and billtime != ''">
				AND billtime = #{billtime}
		   </if>
	       <if test="indecr != null and indecr != ''">
				AND indecr = #{indecr}
		   </if>
	       <if test="billchannel != null and billchannel != ''">
				AND billchannel = #{billchannel}
		   </if>
	       <if test="billret != null and billret != ''">
				AND billret = #{billret}
		   </if>
	       <if test="prebalance != null and prebalance != ''">
				AND prebalance = #{prebalance}
		   </if>
	       <if test="ipaddr != null and ipaddr != ''">
				AND ipaddr = #{ipaddr}
		   </if>
	       <if test="salt != null and salt != ''">
				AND salt = #{salt}
		   </if>
	       <if test="packets != null and packets != ''">
				AND packets = #{packets}
		   </if>
	       <if test="createtime != null and createtime != ''">
				AND createtime = #{createtime}
		   </if>
	       <if test="modifytime != null and modifytime != ''">
				AND modifytime = #{modifytime}
		   </if>
	       <if test="expiretime != null and expiretime != ''">
				AND expiretime = #{expiretime}
		   </if>
	       <if test="information != null and information != ''">
				AND information = #{information}
		   </if>
	       <if test="locked != null and locked != ''">
				AND locked = #{locked}
		   </if>
	       <if test="confirmed != null and confirmed != ''">
				AND confirmed = #{confirmed}
		   </if>
		   <if test="afterbalance != null and afterbalance != ''">
				AND afterbalance = #{afterbalance}
		   </if>
		     <if test="subject != null and subject != ''">
				AND subject = #{subject}
		   </if>
		    <if test="method != null and method != ''">
				AND method = #{method}
		   </if>
		   <if test="balanceid != null and balanceid != ''">
				AND balanceid = #{balanceid}
		   </if>
		   
		</where>
		<if test="sortColumns != null and sortColumns != ''">
			ORDER BY ${sortColumns}
		</if>
	</select>
	
	<!-- 分页查询 -->
	<select id="searchPage" resultMap="resultMap">
		SELECT <include refid="columns" />
		FROM tab_bill
		<where>
	       <if test="searchFields.orderid != null and searchFields.orderid != ''">
				AND orderid = #{searchFields.orderid}
			</if>
	       <if test="searchFields.serialno != null and searchFields.serialno != ''">
				AND serialno = #{searchFields.serialno}
			</if>
	       <if test="searchFields.tradeno != null and searchFields.tradeno != ''">
				AND tradeno = #{searchFields.tradeno}
			</if>
	       <if test="searchFields.amount != null and searchFields.amount != ''">
				AND amount = #{searchFields.amount}
			</if>
	       <if test="searchFields.userid != null and searchFields.userid != ''">
				AND userid = #{searchFields.userid}
			</if>
	       <if test="searchFields.billtime != null and searchFields.billtime != ''">
				AND billtime = #{searchFields.billtime}
			</if>
	       <if test="searchFields.indecr != null and searchFields.indecr != ''">
				AND indecr = #{searchFields.indecr}
			</if>
	       <if test="searchFields.billchannel != null and searchFields.billchannel != ''">
				AND billchannel = #{searchFields.billchannel}
			</if>
	       <if test="searchFields.billret != null and searchFields.billret != ''">
				AND billret = #{searchFields.billret}
			</if>
	       <if test="searchFields.prebalance != null and searchFields.prebalance != ''">
				AND prebalance = #{searchFields.prebalance}
			</if>
	       <if test="searchFields.ipaddr != null and searchFields.ipaddr != ''">
				AND ipaddr = #{searchFields.ipaddr}
			</if>
	       <if test="searchFields.salt != null and searchFields.salt != ''">
				AND salt = #{searchFields.salt}
			</if>
	       <if test="searchFields.packets != null and searchFields.packets != ''">
				AND packets = #{searchFields.packets}
			</if>
	       <if test="searchFields.createtime != null and searchFields.createtime != ''">
				AND createtime = #{searchFields.createtime}
			</if>
	       <if test="searchFields.modifytime != null and searchFields.modifytime != ''">
				AND modifytime = #{searchFields.modifytime}
			</if>
	       <if test="searchFields.expiretime != null and searchFields.expiretime != ''">
				AND expiretime = #{searchFields.expiretime}
			</if>
	       <if test="searchFields.information != null and searchFields.information != ''">
				AND information = #{searchFields.information}
			</if>
	       <if test="searchFields.locked != null and searchFields.locked != ''">
				AND locked = #{searchFields.locked}
			</if>
	       <if test="searchFields.confirmed != null and searchFields.confirmed != ''">
				AND confirmed = #{searchFields.confirmed}
			</if>
			<if test="searchFields.afterbalance != null and searchFields.afterbalance != ''">
				AND afterbalance = #{searchFields.afterbalance}
		   </if>
		   <if test="searchFields.subject != null and searchFields.subject != ''">
				AND subject = #{searchFields.subject}
		   </if>
		    <if test="searchFields.method != null and searchFields.method != ''">
				AND method = #{searchFields.method}
		   </if>
		    <if test="searchFields.balanceid != null and searchFields.balanceid != ''">
				AND balanceid = #{searchFields.balanceid}
		   </if>
		</where>
		<if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
			ORDER BY ${searchFields.sortColumns}
		</if>
	</select>
	
	<!-- 新增 -->
	<insert id="insert" parameterType="Bill" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_bill (
        	orderid,
        	serialno,
        	tradeno,
        	amount,
        	userid,
        	billtime,
        	indecr,
        	billchannel,
        	billret,
        	prebalance,
        	ipaddr,
        	salt,
        	packets,
        	createtime,
        	modifytime,
        	expiretime,
        	information,
        	locked,
        	confirmed,
        	afterbalance,
        	subject,
        	method,
        	balanceid
		) VALUES (
        	#{orderid},
        	#{serialno},
        	#{tradeno},
        	#{amount},
        	#{userid},
        	#{billtime},
        	#{indecr},
        	#{billchannel},
        	#{billret},
        	#{prebalance},
        	#{ipaddr},
        	#{salt},
        	#{packets},
        	#{createtime},
        	#{modifytime},
        	#{expiretime},
        	#{information},
        	#{locked},
        	#{confirmed},
        	#{afterbalance},
        	#{subject},
        	#{method},
        	#{balanceid}
		)
	</insert>
	
	<!-- 更新 -->
	<update id="update" >
        UPDATE tab_bill
		<set>
			<if test="orderid != null">
			orderid = #{orderid},
			</if>
			<if test="serialno != null">
			serialno = #{serialno},
			</if>
			<if test="tradeno != null">
			tradeno = #{tradeno},
			</if>
			<if test="amount != null">
			amount = #{amount},
			</if>
			<if test="userid != null">
			userid = #{userid},
			</if>
			<if test="billtime != null">
			billtime = #{billtime},
			</if>
			<if test="indecr != null">
			indecr = #{indecr},
			</if>
			<if test="billchannel != null">
			billchannel = #{billchannel},
			</if>
			<if test="billret != null">
			billret = #{billret},
			</if>
			<if test="prebalance != null">
			prebalance = #{prebalance},
			</if>
			<if test="ipaddr != null">
			ipaddr = #{ipaddr},
			</if>
			<if test="salt != null">
			salt = #{salt},
			</if>
			<if test="packets != null">
			packets = #{packets},
			</if>
			<if test="createtime != null">
			createtime = #{createtime},
			</if>
			<if test="modifytime != null">
			modifytime = #{modifytime},
			</if>
			<if test="expiretime != null">
			expiretime = #{expiretime},
			</if>
			<if test="information != null">
			information = #{information},
			</if>
			<if test="locked != null">
			locked = #{locked},
			</if>
			<if test="confirmed != null">
			confirmed = #{confirmed},
			</if>
			<if test="afterbalance != null">
			afterbalance = #{afterbalance},
			</if>
			<if test="subject != null">
			subject = #{subject},
			</if>
			<if test="method != null">
			method = #{method},
			</if>
			<if test="balanceid != null">
			balanceid = #{balanceid},
			</if>
			
		</set>
        WHERE 
	        id = #{id}
	</update>
	
	<!-- 删除用户 -->
	<delete id="delete" parameterType="Long">
	     DELETE FROM tab_bill WHERE id=#{id}
	</delete>

	<!-- 查询用户交易明细 -->
	<select id="searchAccountPage" resultMap="resultMap">
        SELECT * FROM 
        ( SELECT * FROM tab_bill order by id desc) as b
		<where>
	       <if test="searchFields.orderid != null">
				AND b.orderid = #{searchFields.orderid}
			</if>
	       <if test="searchFields.serialno != null">
				AND b.serialno = #{searchFields.serialno}
			</if>
	       <if test="searchFields.tradeno != null and searchFields.tradeno != ''">
				AND b.tradeno = #{searchFields.tradeno}
			</if>
	       <if test="searchFields.amount != null">
				AND b.amount = #{searchFields.amount}
			</if>
	       <if test="searchFields.userid != null">
				AND b.userid = #{searchFields.userid}
			</if>
	       <if test="searchFields.billtime != null">
				AND b.billtime = #{searchFields.billtime}
			</if>
	       <if test="searchFields.indecr != null">
				AND b.indecr = #{searchFields.indecr}
			</if>
	       <if test="searchFields.billchannel != null">
				AND b.billchannel = #{searchFields.billchannel}
			</if>
	       <if test="searchFields.billret != null">
				AND b.billret = #{searchFields.billret}
			</if>
	       <if test="searchFields.prebalance != null">
				AND b.prebalance = #{searchFields.prebalance}
			</if>
	       <if test="searchFields.ipaddr != null and searchFields.ipaddr != ''">
				AND b.ipaddr = #{searchFields.ipaddr}
			</if>
	       <if test="searchFields.salt != null and searchFields.salt != ''">
				AND b.salt = #{searchFields.salt}
			</if>
	       <if test="searchFields.packets != null and searchFields.packets != ''">
				AND b.packets = #{searchFields.packets}
			</if>
	       <if test="searchFields.createtime != null and searchFields.createtime != ''">
				AND b.createtime = #{searchFields.createtime}
			</if>
	       <if test="searchFields.modifytime != null and searchFields.modifytime != ''">
				AND b.modifytime = #{searchFields.modifytime}
			</if>
	       <if test="searchFields.expiretime != null and searchFields.expiretime != ''">
				AND b.expiretime = #{searchFields.expiretime}
			</if>
	       <if test="searchFields.information != null and searchFields.information != ''">
				AND b.information = #{searchFields.information}
			</if>
	       <if test="searchFields.locked != null">
				AND b.locked = #{searchFields.locked}
			</if>
	       <if test="searchFields.confirmed != null">
				AND b.confirmed = #{searchFields.confirmed}
			</if>
			<if test="searchFields.afterbalance != null">
				AND b.afterbalance = #{searchFields.afterbalance}
		   </if>
		   <if test="searchFields.subject != null and searchFields.subject!= ''">
				AND b.subject = #{searchFields.subject}
		   </if>
		    <if test="searchFields.method != null and searchFields.method!= ''">
				AND b.method = #{searchFields.method}
		   </if>
		      <if test="searchFields.balanceid != null and searchFields.balanceid!= ''">
				AND b.balanceid = #{searchFields.balanceid}
		   </if>
		  
		</where>
        GROUP BY b.orderid
		<if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
			ORDER BY b.${searchFields.sortColumns}
		</if>
	</select>
	
	<!-- 删除流水 -->
	<delete id="deleteByMarketplanId" parameterType="Long">
	     DELETE FROM tab_bill WHERE orderId=#{orderId}
	</delete>
	
	<select id="findBillByChannleAndMethodAndOrderIdAndUserId" resultType="Bill">
        SELECT * FROM tab_bill
		<where>
	       <if test="orderid != null">
				AND orderid = #{orderid}
		   </if>
	       <if test="userid != null">
				AND userid = #{userid}
		   </if>
	       <if test="billchannel != null">
				AND billchannel = #{billchannel}
			</if>
		    <if test="method != null">
				AND method = #{method}
		   </if>
		</where>
	</select>

    <!-- 提现流水 -->
    <select id="getWithdrawBill" resultType="Bill">
        SELECT * FROM tab_bill
		<where>
	       <if test="orderid != null">
				AND orderid = #{orderid}
		   </if>
	       <if test="userid != null">
				AND userid = #{userid}
		   </if>
           <if test="billret != null">
				AND billret = #{billret}
		   </if>
	       <if test="billchannel != null">
				AND billchannel = #{billchannel}
			</if>
		    <if test="method != null">
				AND method = #{method}
		   </if>
            ORDER BY id desc limit 1
		</where>
	</select>
</mapper> 
