<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.palm.lingcai.repository.PrizeFixedDao">

	<resultMap id="resultMap" type="com.palm.lingcai.entity.PrizeFixed">
        <result property="id" column="id"/>
        <result property="userid" column="userid"/>
        <result property="lotteryid" column="lotteryid"/>
        <result property="userprizeid" column="userprizeid"/>
        <result property="orderid" column="orderid"/>
        <result property="fixedType" column="fixedType"/>
        <result property="fixedMoney" column="fixedMoney"/>
        <result property="fixedtime" column="fixedtime"/>
        <result property="remark" column="remark"/>
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
		id,userid,lotteryid,userprizeid,orderid,fixedType,fixedMoney,fixedtime,remark
	</sql>
	
	<!-- 获取对象: 输出直接映射到对象 -->
	<select id="get" parameterType="Long" resultType="PrizeFixed">
		SELECT <include refid="columns" />
		FROM tab_prize_fixed
		WHERE id=#{id}
	</select>

    <!-- 获取对象: 输出直接映射到对象 -->
	<select id="sumMoney" parameterType="Long" resultType="BigDecimal">
		SELECT sum(fixedMoney)
		FROM tab_prize_fixed
		WHERE userid=#{userid}
	</select>
	

	<!-- 查询列表, 不分页 -->
	<select id="search" parameterType="map" resultMap="resultMap">
		SELECT <include refid="columns" />
		FROM tab_prize_fixed
		<where>
	       <if test="userid != null and userid != ''">
				AND userid = #{userid}
		   </if>
	       <if test="lotteryid != null and lotteryid != ''">
				AND lotteryid = #{lotteryid}
		   </if>
	       <if test="userprizeid != null and userprizeid != ''">
				AND userprizeid = #{userprizeid}
		   </if>
	       <if test="orderid != null and orderid != ''">
				AND orderid = #{orderid}
		   </if>
	       <if test="fixedType != null and fixedType != ''">
				AND fixedType = #{fixedType}
		   </if>
	       <if test="fixedMoney != null and fixedMoney != ''">
				AND fixedMoney = #{fixedMoney}
		   </if>
	       <if test="fixedtime != null and fixedtime != ''">
				AND fixedtime = #{fixedtime}
		   </if>
	       <if test="remark != null and remark != ''">
				AND remark = #{remark}
		   </if>
		</where>
		<if test="sortColumns != null and sortColumns != ''">
			ORDER BY ${sortColumns}
		</if>
	</select>
	
	<!-- 分页查询 -->
	<select id="searchPage" resultMap="resultMap">
		SELECT a.*,b.gameid as gameid,b.issueNo as issueNo
		FROM tab_prize_fixed a,tab_user_prize b
		<where>
	       <if test="searchFields.userid != null and searchFields.userid != ''">
				AND a.userid = #{searchFields.userid}
			</if>
	       <if test="searchFields.lotteryid != null and searchFields.lotteryid != ''">
				AND a.lotteryid = #{searchFields.lotteryid}
			</if>
	       <if test="searchFields.userprizeid != null and searchFields.userprizeid != ''">
				AND a.userprizeid = #{searchFields.userprizeid}
			</if>
	       <if test="searchFields.orderid != null and searchFields.orderid != ''">
				AND a.orderid = #{searchFields.orderid}
			</if>
	       <if test="searchFields.fixedType != null and searchFields.fixedType != ''">
				AND a.fixedType = #{searchFields.fixedType}
			</if>
	       <if test="searchFields.fixedMoney != null and searchFields.fixedMoney != ''">
				AND a.fixedMoney = #{searchFields.fixedMoney}
			</if>
	       <if test="searchFields.fixedtime != null and searchFields.fixedtime != ''">
				AND a.fixedtime = #{searchFields.fixedtime}
			</if>
	       <if test="searchFields.remark != null and searchFields.remark != ''">
				AND a.remark = #{searchFields.remark}
			</if>
            AND a.userprizeid = b.id
		</where>
		<if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
			ORDER BY ${searchFields.sortColumns}
		</if>
	</select>
	
	<!-- 新增 -->
	<insert id="insert" parameterType="PrizeFixed" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_prize_fixed (
        	userid,
        	lotteryid,
        	userprizeid,
        	orderid,
        	fixedType,
        	fixedMoney,
        	fixedtime,
        	remark
		) VALUES (
        	#{userid},
        	#{lotteryid},
        	#{userprizeid},
        	#{orderid},
        	#{fixedType},
        	#{fixedMoney},
        	#{fixedtime},
        	#{remark}
		)
	</insert>
	
	<!-- 更新 -->
	<update id="update" >
        UPDATE tab_prize_fixed
		<set>
			<if test="userid != null">
			userid = #{userid},
			</if>
			<if test="lotteryid != null">
			lotteryid = #{lotteryid},
			</if>
			<if test="userprizeid != null">
			userprizeid = #{userprizeid},
			</if>
			<if test="orderid != null">
			orderid = #{orderid},
			</if>
			<if test="fixedType != null">
			fixedType = #{fixedType},
			</if>
			<if test="fixedMoney != null">
			fixedMoney = #{fixedMoney},
			</if>
			<if test="fixedtime != null">
			fixedtime = #{fixedtime},
			</if>
			<if test="remark != null">
			remark = #{remark}
			</if>
		</set>
        WHERE 
	        id = #{id}
	</update>
	
	<!-- 删除用户 -->
	<delete id="delete" parameterType="Long">
	     DELETE FROM tab_prize_fixed WHERE id=#{id}
	</delete>
</mapper> 
