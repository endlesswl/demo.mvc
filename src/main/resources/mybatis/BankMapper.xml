<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.palm.lingcai.repository.BankDao">

    <resultMap id="resultMap" type="com.palm.lingcai.entity.Bank">
        <result property="id" column="id"/>
        <result property="userid" column="userid"/>
        <result property="bankname" column="bankname"/>
        <result property="abbreviation" column="abbreviation"/>
        <result property="description" column="description"/>
        <result property="accountname" column="accountname"/>
        <result property="cardno" column="cardno"/>
        <result property="cardtype" column="cardtype"/>
        <result property="city" column="city"/>
        <result property="province" column="province"/>
         <result property="subbranch" column="subbranch"/>
         <result property="deleteFlag" column="deleteFlag"/>
         
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
		id,userid,bankname,abbreviation,description,accountname,cardno,cardtype,city,province,subbranch,deleteFlag
	</sql>

    <!-- 获取银行卡: 输出直接映射到对象 -->
    <select id="get" parameterType="Long" resultType="Bank">
        SELECT
        <include refid="columns"/>
        FROM tab_bank
        WHERE id=#{id} AND deleteFlag = 0
    </select>

	

  <select id="findMinShengBankByCardNoAndRealName"  resultType="Bank">
        SELECT
        <include refid="columns"/>
        FROM tab_bank
        WHERE accountname=#{accountname} AND cardno = #{cardno} limit 1
    </select>
    
    
    <!-- 根据用户ID获得银行卡列表 -->
    <select id="getByUser" parameterType="Long" resultMap="resultMap">
        SELECT *
        FROM tab_bank
        WHERE userid=#{userid} AND deleteFlag = 0
    </select>
      <!-- 根据用户ID,银行卡号 -->
     <select id="findMinShengBank" resultMap="resultMap">
        SELECT *
        FROM tab_bank
        WHERE userid=#{userid} AND cardno = #{cardno} limit 1
    </select>
    
    

    <!-- 查询银行卡列表, 不分页 -->
    <select id="search" parameterType="map" resultMap="resultMap">
        SELECT
        <include refid="columns"/>
        FROM tab_bank
        <where>
            <if test="userid != null and userid != ''">
                AND userid = #{userid}
            </if>
            <if test="bankname != null and bankname != ''">
                AND bankname = #{bankname}
            </if>
            <if test="abbreviation != null and abbreviation != ''">
                AND abbreviation = #{abbreviation}
            </if>
            <if test="description != null and description != ''">
                AND description = #{description}
            </if>
            <if test="accountname != null and accountname != ''">
                AND accountname = #{accountname}
            </if>
            <if test="cardno != null and cardno != ''">
                AND cardno = #{cardno}
            </if>
            <if test="cardtype != null and cardtype != ''">
                AND cardtype = #{cardtype}
            </if>
            AND deleteFlag = 0
        </where>
    </select>

    <!-- 分页查询 -->
    <select id="searchPage" resultMap="resultMap">
        SELECT
        <include refid="columns"/>
        FROM tab_bank
        <where>
            <if test="searchFields.userid != null and searchFields.userid != ''">
                AND userid = #{searchFields.userid}
            </if>
            <if test="searchFields.bankname != null and searchFields.bankname != ''">
                AND bankname = #{searchFields.bankname}
            </if>
            <if test="searchFields.abbreviation != null and searchFields.abbreviation != ''">
                AND abbreviation = #{searchFields.abbreviation}
            </if>
            <if test="searchFields.description != null and searchFields.description != ''">
                AND description = #{searchFields.description}
            </if>
            <if test="searchFields.accountname != null and searchFields.accountname != ''">
                AND accountname = #{searchFields.accountname}
            </if>
            <if test="searchFields.cardno != null and searchFields.cardno != ''">
                AND cardno = #{searchFields.cardno}
            </if>
            <if test="searchFields.cardtype != null and searchFields.cardtype != ''">
                AND cardtype = #{searchFields.cardtype}
            </if>
            AND deleteFlag = 0
        </where>
    </select>

    <!-- 新增 -->
    <insert id="insert" parameterType="Bank" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_bank (
        	userid,
        	bankname,
        	abbreviation,
        	description,
        	accountname,
        	cardno,
        	cardtype,
        	city,
        	province,
        	subbranch,
        	deleteFlag
		) VALUES (
        	#{userid},
        	#{bankname},
        	#{abbreviation},
        	#{description},
        	#{accountname},
        	#{cardno},
        	#{cardtype},
        	#{city},
        	#{province},
        	#{subbranch},
        	#{deleteFlag}
		)
	</insert>

    <!-- 更新 -->
    <update id="update">
        UPDATE tab_bank
        <set>
            userid = #{userid},
            bankname = #{bankname},
            abbreviation = #{abbreviation},
            description = #{description},
            accountname = #{accountname},
            cardno = #{cardno},
            cardtype = #{cardtype},
            city=#{city},
        	province=#{province},
        	subbranch=#{subbranch},
        	deleteFlag=#{deleteFlag}
        </set>
        WHERE
        id = #{id}
    </update>

    <!-- 删除用户 -->
    <update id="delete" parameterType="Long">
	     UPDATE tab_bank SET deleteFlag = 1 WHERE id=#{id} AND userid=#{userid}
	</update>
</mapper> 
