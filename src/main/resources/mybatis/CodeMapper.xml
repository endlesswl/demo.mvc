<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.palm.lingcai.repository.CodeDao">

    <resultMap id="resultMap" type="com.palm.lingcai.entity.Code">
        <result property="id" column="id"/>
        <result property="marketid" column="marketid"/>
        <result property="code" column="code"/>
        <result property="isUse" column="isUse"/>
        <result property="createtime" column="createtime"/>
        <result property="updatetime" column="updatetime"/>
        <result property="lotterySplitid" column="lotterySplitid"/>
        <result property="userid" column="userid"/>
        <result property="openid" column="openid"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
		id,marketid,code,isUse,createtime,updatetime,lotterySplitid,userid,openid
	</sql>

    <!-- 获取用户: 输出直接映射到对象 -->
    <select id="get" parameterType="Long" resultType="Code">
        SELECT
        <include refid="columns"/>
        FROM tab_code
        WHERE id=#{id}
    </select>

    <!-- 获取: 根据CODE-->
    <select id="getByCodeAndMarketidAndOpenId" parameterType="String" resultType="Code">
        SELECT
        <include refid="columns"/>
        FROM tab_code
        WHERE code=#{code} and marketid = #{marketid} and openid=#{openid} and isUse = 1 limit 1
    </select>


    <!-- 查询用户, 不分页 -->
    <select id="search" parameterType="map" resultMap="resultMap">
        SELECT
        <include refid="columns"/>
        FROM tab_code
        <where>
            <if test="marketid != null and marketid != ''">
                AND marketid = #{marketid}
            </if>
            <if test="updatetime != null and updatetime != ''">
                AND updatetime = #{updatetime}
            </if>
            <if test="code != null and code != ''">
                AND code = #{code}
            </if>
            <if test="isUse != null and isUse != ''">
                AND isUse = #{isUse}
            </if>
            <if test="createtime != null and createtime != ''">
                AND createtime = #{createtime}
            </if>
            <if test="lotterySplitid != null and lotterySplitid != ''">
                AND lotterySplitid = #{lotterySplitid}
            </if>
        </where>
       <!--  <if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
            ORDER BY ${searchFields.sortColumns}
        </if> -->
    </select>

    <!-- 分页查询 -->
    <select id="searchPage" resultMap="resultMap">
        SELECT
        <include refid="columns"/>
        FROM tab_code
        <where>
            <if test="searchFields.updatetime != null and searchFields.updatetime != ''">
                AND updatetime = #{searchFields.updatetime}
            </if>
            <if test="searchFields.marketid != null and searchFields.marketid != ''">
                AND marketid = #{searchFields.marketid}
            </if>
            <if test="searchFields.code != null and searchFields.code != ''">
                AND code = #{searchFields.code}
            </if>
            <if test="searchFields.isUse != null and searchFields.isUse != ''">
                AND isUse = #{searchFields.isUse}
            </if>
            <if test="searchFields.createtime != null and searchFields.createtime != ''">
                AND createtime = #{searchFields.createtime}
            </if>
        </where>
        <if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
            ORDER BY ${searchFields.sortColumns}
        </if>
    </select>
    <!-- 新增 -->
    <insert id="insert" parameterType="Code" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_code (
        	marketid,
        	code,
        	isUse,
        	createtime,
        	updatetime,
        	lotterySplitid,
        	userid,
        	openid
		) VALUES (
        	#{marketid},
        	#{code},
        	#{isUse},
        	#{createtime},
        	#{updatetime},
        	#{lotterySplitid},
        	#{userid},
        	#{openid}
		)
	</insert>

    <!-- 更新 -->
    <update id="update">
        UPDATE tab_code
        <set>
            marketid = #{marketid},
            code = #{code},
            isUse = #{isUse},
            createtime = #{createtime},
            updatetime = #{updatetime},
            lotterySplitid = #{lotterySplitid},
            userid = #{userid},
            openid =  #{openid}
        </set>
        WHERE
        id = #{id}
    </update>

    <!-- 删除用户 -->
    <delete id="delete" parameterType="Long">
	     DELETE FROM tab_code WHERE id=#{id}
	</delete>
</mapper> 
