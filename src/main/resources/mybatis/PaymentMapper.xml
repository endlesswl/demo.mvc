<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace必须指向Dao接口 -->
<mapper namespace="com.palm.lingcai.repository.PaymentDao">

	<resultMap id="resultMap" type="com.palm.lingcai.entity.Payment">
        <result property="id" column="id"/>
        <result property="subject" column="subject"/>
        <result property="amount" column="amount"/>
        <result property="fee" column="fee"/>
        <result property="rate" column="rate"/>
        <result property="actualAmount" column="actualAmount"/>
        <result property="orderid" column="orderid"/>
        <result property="tradeno" column="tradeno"/>
        <result property="method" column="method"/>
        <result property="methodExt" column="methodExt"/>
        <result property="status" column="status"/>
        <result property="prebalance" column="prebalance"/>
        <result property="ipaddr" column="ipaddr"/>
        <result property="salt" column="salt"/>
        <result property="createtime" column="createtime"/>
        <result property="modifytime" column="modifytime"/>
        <result property="expiretime" column="expiretime"/>
        <result property="fixedtime" column="fixedtime"/>
        <result property="information" column="information"/>
        <result property="confirmed" column="confirmed"/>
        <result property="remark" column="remark"/>
        <result property="userid" column="userid"/>
        <result property="marketid" column="marketid"/>
        <result property="deleteFlag" column="deleteFlag"/>
        
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="columns">
		id,subject,amount,fee,rate,actualAmount,orderid,tradeno,method,methodExt,status,prebalance,ipaddr,salt,createtime,modifytime,expiretime,fixedtime,information,confirmed,remark,userid,marketid,deleteFlag
	</sql>
	
	<!-- 获取对象: 输出直接映射到对象 -->
	<select id="get" parameterType="Long" resultType="Payment">
		SELECT <include refid="columns" />
		FROM tab_payment
		WHERE id=#{id}
	</select>
	

	<!-- 查询列表, 不分页 -->
	<select id="search" parameterType="map" resultMap="resultMap">
		SELECT <include refid="columns" />
		FROM tab_payment
		<where>
	       <if test="subject != null and subject != ''">
				AND subject = #{subject}
		   </if>
	       <if test="amount != null and amount != ''">
				AND amount = #{amount}
		   </if>
	       <if test="fee != null and fee != ''">
				AND fee = #{fee}
		   </if>
	       <if test="rate != null and rate != ''">
				AND rate = #{rate}
		   </if>
	       <if test="actualAmount != null and actualAmount != ''">
				AND actualAmount = #{actualAmount}
		   </if>
	       <if test="orderid != null and orderid != ''">
				AND orderid = #{orderid}
		   </if>
	       <if test="tradeno != null and tradeno != ''">
				AND tradeno = #{tradeno}
		   </if>
	       <if test="method != null and method != ''">
				AND method = #{method}
		   </if>
	       <if test="methodExt != null and methodExt != ''">
				AND methodExt = #{methodExt}
		   </if>
	       <if test="status != null and status != ''">
				AND status = #{status}
		   </if>
	       <if test="prebalance != null and prebalance != ''">
				AND prebalance = #{prebalance}
		   </if>
	       <if test="ipaddr != null and ipaddr != ''">
				AND ipaddr = #{ipaddr}
		   </if>
	       <if test="salt != null and salt != ''">
				AND salt = #{salt}
		   </if>
	       <if test="createtime != null and createtime != ''">
				AND createtime = #{createtime}
		   </if>
	       <if test="modifytime != null and modifytime != ''">
				AND modifytime = #{modifytime}
		   </if>
	       <if test="expiretime != null and expiretime != ''">
				AND expiretime = #{expiretime}
		   </if>
	       <if test="fixedtime != null and fixedtime != ''">
				AND fixedtime = #{fixedtime}
		   </if>
	       <if test="information != null and information != ''">
				AND information = #{information}
		   </if>
	       <if test="confirmed != null and confirmed != ''">
				AND confirmed = #{confirmed}
		   </if>
	       <if test="remark != null and remark != ''">
				AND remark = #{remark}
		   </if>
	       <if test="userid != null and userid != ''">
				AND userid = #{userid}
		   </if>
	       <if test="marketid != null and marketid != ''">
				AND marketid = #{marketid}
		   </if>
	       <if test="deleteFlag != null and deleteFlag != ''">
				AND deleteFlag = #{deleteFlag}
		   </if>
		</where>
		<if test="sortColumns != null and sortColumns != ''">
			ORDER BY ${sortColumns}
		</if>
	</select>
	
	<!-- 分页查询 -->
	<select id="searchPage" resultMap="resultMap">
		SELECT <include refid="columns" />
		FROM tab_payment
		<where>
	       <if test="searchFields.subject != null and searchFields.subject != ''">
				AND subject = #{searchFields.subject}
			</if>
	       <if test="searchFields.amount != null and searchFields.amount != ''">
				AND amount = #{searchFields.amount}
			</if>
	       <if test="searchFields.fee != null and searchFields.fee != ''">
				AND fee = #{searchFields.fee}
			</if>
	       <if test="searchFields.rate != null and searchFields.rate != ''">
				AND rate = #{searchFields.rate}
			</if>
	       <if test="searchFields.actualAmount != null and searchFields.actualAmount != ''">
				AND actualAmount = #{searchFields.actualAmount}
			</if>
	       <if test="searchFields.orderid != null and searchFields.orderid != ''">
				AND orderid = #{searchFields.orderid}
			</if>
	       <if test="searchFields.tradeno != null and searchFields.tradeno != ''">
				AND tradeno = #{searchFields.tradeno}
			</if>
	       <if test="searchFields.method != null and searchFields.method != ''">
				AND method = #{searchFields.method}
			</if>
	       <if test="searchFields.methodExt != null and searchFields.methodExt != ''">
				AND methodExt = #{searchFields.methodExt}
		   </if>
	       <if test="searchFields.status != null and searchFields.status != ''">
				AND status = #{searchFields.status}
		   </if>
		   <if test="searchFields.istatus != null and searchFields.istatus != ''">
				AND status != #{searchFields.istatus}
		   </if>
	       <if test="searchFields.prebalance != null and searchFields.prebalance != ''">
				AND prebalance = #{searchFields.prebalance}
			</if>
	       <if test="searchFields.ipaddr != null and searchFields.ipaddr != ''">
				AND ipaddr = #{searchFields.ipaddr}
			</if>
	       <if test="searchFields.salt != null and searchFields.salt != ''">
				AND salt = #{searchFields.salt}
			</if>
	       <if test="searchFields.createtime != null and searchFields.createtime != ''">
				AND createtime = #{searchFields.createtime}
			</if>
	       <if test="searchFields.modifytime != null and searchFields.modifytime != ''">
				AND modifytime = #{searchFields.modifytime}
			</if>
	       <if test="searchFields.expiretime != null and searchFields.expiretime != ''">
				AND expiretime = #{searchFields.expiretime}
			</if>
	       <if test="searchFields.fixedtime != null and searchFields.fixedtime != ''">
				AND fixedtime = #{searchFields.fixedtime}
			</if>
	       <if test="searchFields.information != null and searchFields.information != ''">
				AND information = #{searchFields.information}
			</if>
	       <if test="searchFields.confirmed != null and searchFields.confirmed != ''">
				AND confirmed = #{searchFields.confirmed}
			</if>
	       <if test="searchFields.remark != null and searchFields.remark != ''">
				AND remark = #{searchFields.remark}
			</if>
	       <if test="searchFields.userid != null and searchFields.userid != ''">
				AND userid = #{searchFields.userid}
			</if>
	       <if test="searchFields.marketid != null and searchFields.marketid != ''">
				AND marketid = #{searchFields.marketid}
			</if>
	       <if test="searchFields.deleteFlag != null and searchFields.deleteFlag != ''">
				AND deleteFlag = #{searchFields.deleteFlag}
			</if>
			<if test="searchFields.sbilltime != null and searchFields.sbilltime != ''">
	       		<![CDATA[AND createtime  >= #{searchFields.sbilltime}]]>
		  	</if>
	      	<if test="searchFields.ebilltime != null and searchFields.ebilltime != ''">
				<![CDATA[AND createtime  <= #{searchFields.ebilltime}]]>
		  	</if>
			
		</where>
		<if test="searchFields.sortColumns != null and searchFields.sortColumns != ''">
			ORDER BY ${searchFields.sortColumns}
		</if>
	</select>
	
	<!-- 新增 -->
	<insert id="insert" parameterType="Payment" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_payment (
        	subject,
        	amount,
        	fee,
        	rate,
        	actualAmount,
        	orderid,
        	tradeno,
        	method,
        	methodExt,
        	status,
        	prebalance,
        	ipaddr,
        	salt,
        	createtime,
        	modifytime,
        	expiretime,
        	fixedtime,
        	information,
        	confirmed,
        	remark,
        	userid,
        	marketid,
        	deleteFlag
		) VALUES (
        	#{subject},
        	#{amount},
        	#{fee},
        	#{rate},
        	#{actualAmount},
        	#{orderid},
        	#{tradeno},
        	#{method},
        	#{methodExt},
        	#{status},
        	#{prebalance},
        	#{ipaddr},
        	#{salt},
        	#{createtime},
        	#{modifytime},
        	#{expiretime},
        	#{fixedtime},
        	#{information},
        	#{confirmed},
        	#{remark},
        	#{userid},
        	#{marketid},
        	#{deleteFlag}
		)
	</insert>
	
	<!-- 更新 -->
	<update id="update" >
        UPDATE tab_payment
		<set>
			<if test="subject != null">
			subject = #{subject},
			</if>
			<if test="amount != null">
			amount = #{amount},
			</if>
			<if test="fee != null">
			fee = #{fee},
			</if>
			<if test="rate != null">
			rate = #{rate},
			</if>
			<if test="actualAmount != null">
			actualAmount = #{actualAmount},
			</if>
			<if test="orderid != null">
			orderid = #{orderid},
			</if>
			<if test="tradeno != null">
			tradeno = #{tradeno},
			</if>
			<if test="method != null">
			method = #{method},
			</if>
			<if test="methodExt != null">
			methodExt = #{methodExt},
			</if>
			<if test="status != null">
			status = #{status},
			</if>
			<if test="prebalance != null">
			prebalance = #{prebalance},
			</if>
			<if test="ipaddr != null">
			ipaddr = #{ipaddr},
			</if>
			<if test="salt != null">
			salt = #{salt},
			</if>
			<if test="createtime != null">
			createtime = #{createtime},
			</if>
			<if test="modifytime != null">
			modifytime = #{modifytime},
			</if>
			<if test="expiretime != null">
			expiretime = #{expiretime},
			</if>
			<if test="fixedtime != null">
			fixedtime = #{fixedtime},
			</if>
			<if test="information != null">
			information = #{information},
			</if>
			<if test="confirmed != null">
			confirmed = #{confirmed},
			</if>
			<if test="remark != null">
			remark = #{remark},
			</if>
			<if test="userid != null">
			userid = #{userid},
			</if>
			<if test="marketid != null">
			marketid = #{marketid},
			</if>
			<if test="deleteFlag != null">
			deleteFlag = #{deleteFlag}
			</if>
		</set>
        WHERE 
	        id = #{id}
	</update>
	
	<!-- 删除用户 -->
	<delete id="delete" parameterType="Long">
	     DELETE FROM tab_payment WHERE id=#{id}
	</delete>

	<!-- 查询根据orderid -->
	<select id="findPaymentByOrderId" resultType="Payment" >
		SELECT <include refid="columns" />
		FROM tab_payment
		<where>
	       <if test="orderid != null and orderid != ''">
				AND orderid = #{orderid}
		   </if>
	       <if test="userid != null and userid != ''">
				AND userid = #{userid}
		   </if>
		</where>
	</select>
	
<!-- 	findPaymentByMarketIdAndUserId -->
	<!-- 查询支付记录根据计划id，用户id -->
	<select id="findPaymentByMarketIdAndUserId" resultType="Payment" >
		SELECT <include refid="columns" />
		FROM tab_payment
		<where>
	       <if test="userid != null and userid != ''">
				AND userid = #{userid}
		   </if>
	       <if test="marketid != null and marketid != ''">
				AND marketid = #{marketid}
		   </if>
		</where>
	</select>
	
	<!-- 	查询支付记录根据计划id，用户id,支付订单号  -->
	<select id="findPaymentByOrderIdAndMakretId" resultType="Payment" >
			SELECT <include refid="columns" />
			FROM tab_payment
			<where>
		       <if test="orderid != null and orderid != ''">
					AND orderid = #{orderid}
			   </if>
		       <if test="userid != null and userid != ''">
					AND userid = #{userid}
			   </if>
			   <if test="marketid != null and marketid != ''">
					AND marketid = #{marketid}
			   </if>
			</where>
	</select>
	
	<select id="findPaymentsByMarketIdAndUserId" resultMap="resultMap">
			SELECT <include refid="columns" />
			FROM tab_payment
			<where>
		       <if test="status != null and status != ''">
					AND status = #{status}
			   </if>
		       <if test="userid != null and userid != ''">
					AND userid = #{userid}
			   </if>
			   <if test="marketid != null and marketid != ''">
					AND marketid = #{marketid}
			   </if>
			</where>
	</select>
</mapper> 
